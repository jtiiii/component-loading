(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=factory(global,true)}else{factory(global)}})(typeof window!=="undefined"?window:this,function(window,isGlobal){let Loading=function(el){this.el=el;this.$dom().addClass("loading");this.playing=false;this.playStack=[]};let jq=undefined;Loading.setJQuery=($=>jq=$);Loading.prototype={constructor:Loading,show:function(){let play=next=>{this.$dom().addClass("loading-begin");setTimeout(()=>{this.$dom().removeClass("loading-begin");this.$dom().addClass("loading-run");next()},300)};this.playStack.push(play);setTimeout(this._play(),10)},hide:function(){let play=next=>{this.$dom().removeClass("loading-run");this.$dom().addClass("loading-end");this.loading=false;setTimeout(()=>{this.$dom().removeClass("loading-end");next()},300)};this.playStack.push(play);setTimeout(this._play(),10)},$dom:function(){if(!jq){throw new Error("The jquery is required! You need use 'Loading.setJQuery()' first or global/window has jquery object -- '$'.")}return jq(this.el)},_play:function(){if(this.playing){return}this.playing=true;this._executeStack().then(()=>{this.playing=false})},_executeStack:function(){let next=this.playStack.shift();return new Promise(next).then(()=>{if(this.playStack.length!==0){return this._executeStack()}})}};if(!isGlobal){window.Loading=Loading}Loading.setJQuery(window.$);return Loading});
